generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Country {
  country_id    Int            @id @default(autoincrement())
  country_name  String         @db.VarChar(100)
  employeeAreas EmployeeArea[]
  states        State[]
}

model State {
  state_id      Int            @id @default(autoincrement())
  state_name    String         @db.VarChar(100)
  country_id    Int
  employeeAreas EmployeeArea[]
  regions       Region[]
  country       Country        @relation(fields: [country_id], references: [country_id], onDelete: Cascade)
}

model Region {
  region_id     Int            @id @default(autoincrement())
  region_name   String         @db.VarChar(100)
  state_id      Int
  districts     District[]
  employeeAreas EmployeeArea[]
  state         State          @relation(fields: [state_id], references: [state_id], onDelete: Cascade)
}

model District {
  district_id   Int            @id @default(autoincrement())
  district_name String         @db.VarChar(100)
  region_id     Int
  cities        City[]
  region        Region         @relation(fields: [region_id], references: [region_id], onDelete: Cascade)
  employeeAreas EmployeeArea[]
}

model City {
  city_id       Int            @id @default(autoincrement())
  city_name     String         @db.VarChar(100)
  district_id   Int
  district      District       @relation(fields: [district_id], references: [district_id], onDelete: Cascade)
  employeeAreas EmployeeArea[]
  zones         Zone[]
}

model Zone {
  zone_id       Int            @id @default(autoincrement())
  zone_name     String         @db.VarChar(100)
  city_id       Int
  areas         Area[]
  employeeAreas EmployeeArea[]
  city          City           @relation(fields: [city_id], references: [city_id], onDelete: Cascade)
}

model Area {
  area_id       Int            @id @default(autoincrement())
  area_name     String         @db.VarChar(100)
  zone_id       Int
  accounts      Account[]
  zone          Zone           @relation(fields: [zone_id], references: [zone_id], onDelete: Cascade)
  employeeAreas EmployeeArea[]
}

model Department {
  id        String   @id
  name      String   @unique
  createdAt DateTime @default(now())
  users     User[]
}

model Role {
  id        String   @id
  name      String
  createdAt DateTime @default(now())
  users     User[]
}

model User {
  id                 String        @id
  employeeCode       String?       @unique
  name               String?
  email              String?       @unique
  contactNumber      String        @unique
  alternativeNumber  String?
  roleId             String?
  roles              String[]      @default([])
  departmentId       String?
  otp                String?
  otpExpiry          DateTime?
  lastLogin          DateTime?
  isActive           Boolean       @default(true)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  dateOfBirth        DateTime?
  gender             String?
  image              String?
  preferredLanguages String[]
  address            String?
  city               String?
  state              String?
  pincode            String?
  country            String?
  district           String?
  area               String?
  latitude           Float?
  longitude          Float?
  aadharCard         String?
  panCard            String?
  password           String?
  notes              String?
  assignedAccounts   Account[]           @relation("AccountAssignedTo")
  createdAccounts    Account[]           @relation("AccountCreatedBy")
  approvedAccounts   Account[]           @relation("AccountApprovedBy")
  employeeArea       EmployeeArea?
  salaryInformation  SalaryInformation?
  expenses           Expense[]           @relation("EmployeeExpenses")
  approvedExpenses   Expense[]           @relation("ApprovedExpenses")
  department         Department?         @relation(fields: [departmentId], references: [id])
  role               Role?               @relation(fields: [roleId], references: [id])
}

model EmployeeArea {
  area_id     Int?
  city_id     Int?
  country_id  Int?
  district_id Int?
  employeeId  String    @unique
  latitude    Float?
  longitude   Float?
  region_id   Int?
  state_id    Int?
  zone_id     Int?
  id          Int       @id @default(autoincrement())
  area        Area?     @relation(fields: [area_id], references: [area_id])
  city        City?     @relation(fields: [city_id], references: [city_id])
  country     Country?  @relation(fields: [country_id], references: [country_id])
  district    District? @relation(fields: [district_id], references: [district_id])
  employee    User      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  region      Region?   @relation(fields: [region_id], references: [region_id])
  state       State?    @relation(fields: [state_id], references: [state_id])
  zone        Zone?     @relation(fields: [zone_id], references: [zone_id])
}

model Account {
  id                    String    @id
  accountCode           String    @unique
  businessName          String?   // Made optional to handle existing data
  businessType          String?
  businessSize          String?   // New field: Semi Retailer, Retailer, Semi Wholesaler, Wholesaler, Home Buyer
  personName            String
  contactNumber         String
  dateOfBirth           DateTime?
  customerStage         String?
  funnelStage           String?
  gstNumber             String?
  panCard               String?
  ownerImage            String?   // URL to business owner personal image
  shopImage             String?   // URL to shop image
  isActive              Boolean   @default(true)
  
  // Location fields (pincode-based)
  pincode               String?
  country               String?
  state                 String?
  district              String?
  city                  String?
  area                  String?
  address               String?   // Manual address field
  latitude              Float?    // Geolocation latitude
  longitude             Float?    // Geolocation longitude
  
  // Legacy area relation (kept for backward compatibility)
  areaId                Int?
  
  // Assignment and approval
  assignedToId          String?
  createdById           String?
  approvedById          String?
  approvedAt            DateTime?
  isApproved            Boolean   @default(false)
  
  // Timestamps
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  // Relations
  areaRelation          Area?     @relation(fields: [areaId], references: [area_id])
  assignedTo            User?     @relation("AccountAssignedTo", fields: [assignedToId], references: [id])
  createdBy             User?     @relation("AccountCreatedBy", fields: [createdById], references: [id])
  approvedBy            User?     @relation("AccountApprovedBy", fields: [approvedById], references: [id])
  
  @@index([pincode])
  @@index([isActive])
  @@index([customerStage])
  @@index([createdAt])
  @@index([businessType])
  @@index([businessSize])
}

model SalaryInformation {
  id                    String    @id @default(cuid())
  employeeId            String    @unique
  basicSalary           Float
  hra                   Float?    @default(0)
  travelAllowance       Float?    @default(0)
  dailyAllowance        Float?    @default(0)
  medicalAllowance      Float?    @default(0)
  specialAllowance      Float?    @default(0)
  otherAllowances       Float?    @default(0)
  providentFund         Float?    @default(0)
  professionalTax       Float?    @default(0)
  incomeTax             Float?    @default(0)
  otherDeductions       Float?    @default(0)
  effectiveFrom         DateTime
  effectiveTo           DateTime?
  currency              String    @default("INR")
  paymentFrequency      String    @default("Monthly")
  bankName              String?
  accountNumber         String?
  ifscCode              String?
  panNumber             String?
  remarks               String?
  isActive              Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  employee              User      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([effectiveFrom])
  @@index([isActive])
}

model Expense {
  id              String    @id @default(cuid())
  employeeId      String
  expenseType     String    // Travel, Food, Accommodation, Fuel, Other
  amount          Float
  expenseDate     DateTime
  description     String?
  billNumber      String?
  attachmentUrl   String?   // For bill/receipt image
  status          String    @default("Pending") // Pending, Approved, Rejected, Paid
  approvedBy      String?
  approvedAt      DateTime?
  rejectionReason String?
  paidAt          DateTime?
  remarks         String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  employee        User      @relation("EmployeeExpenses", fields: [employeeId], references: [id], onDelete: Cascade)
  approver        User?     @relation("ApprovedExpenses", fields: [approvedBy], references: [id])

  @@index([employeeId])
  @@index([status])
  @@index([expenseDate])
  @@index([expenseType])
}
