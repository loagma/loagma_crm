generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Country {
  id     Int     @id @default(autoincrement()) @map("country_id")
  name   String  @map("country_name") @db.VarChar(100)
  states State[]

  @@map("country")
}

model State {
  id        Int        @id @default(autoincrement()) @map("state_id")
  name      String     @map("state_name") @db.VarChar(100)
  countryId Int?       @map("country_id")
  districts District[]
  country   Country?   @relation(fields: [countryId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("state")
}

model District {
  id      Int    @id @default(autoincrement()) @map("district_id")
  name    String @map("district_name") @db.VarChar(100)
  stateId Int?   @map("state_id")
  cities  City[]
  state   State? @relation(fields: [stateId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("district")
}

model City {
  id         Int       @id @default(autoincrement()) @map("city_id")
  name       String    @map("city_name") @db.VarChar(100)
  districtId Int?      @map("district_id")
  district   District? @relation(fields: [districtId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  zones      Zone[]

  @@map("city")
}

model Zone {
  id     Int    @id @default(autoincrement()) @map("zone_id")
  name   String @map("zone_name") @db.VarChar(100)
  cityId Int?   @map("city_id")
  areas  Area[]
  city   City?  @relation(fields: [cityId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("zone")
}

model Area {
  id     Int    @id @default(autoincrement()) @map("area_id")
  name   String @map("area_name") @db.VarChar(100)
  zoneId Int?   @map("zone_id")
  zone   Zone?  @relation(fields: [zoneId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("area")
}

model Role {
  id         String   @id @default(uuid())
  code       String   @unique
  name       String
  level      Int
  reportsTo  String?
  createdAt  DateTime @default(now())
  parentRole Role?    @relation("RoleHierarchy", fields: [reportsTo], references: [id])
  childRoles Role[]   @relation("RoleHierarchy")
  users      User[]
}

model Department {
  id        String           @id @default(uuid())
  name      String           @unique
  createdAt DateTime         @default(now())
  roles     FunctionalRole[]
  users     User[]
}

model FunctionalRole {
  id           String           @id @default(uuid())
  name         String
  level        Int?
  departmentId String
  reportsToId  String?
  createdAt    DateTime         @default(now())
  department   Department       @relation(fields: [departmentId], references: [id])
  parentRole   FunctionalRole?  @relation("FunctionalRoleHierarchy", fields: [reportsToId], references: [id])
  subRoles     FunctionalRole[] @relation("FunctionalRoleHierarchy")
  users        User[]
}

model User {
  id                 String          @id @default(uuid())
  name               String?
  email              String?         @unique
  contactNumber      String          @unique
  roleId             String?
  functionalRoleId   String?
  departmentId       String?
  managerId          String?
  otp                String?
  otpExpiry          DateTime?
  lastLogin          DateTime?
  isActive           Boolean         @default(true)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  dateOfBirth        DateTime?
  designation        String?
  employeeCode       String?         @unique
  gender             String?
  image              String?
  inchargeCode       String?
  inchargeName       String?
  jobPost            String?
  jobPostCode        String?
  jobPostName        String?
  joiningDate        DateTime?
  nationality        String?
  postUnder          String?
  preferredLanguages String[]
  accounts           Account[]
  employeeAreas      EmployeeArea[]
  department         Department?     @relation(fields: [departmentId], references: [id])
  functionalRole     FunctionalRole? @relation(fields: [functionalRoleId], references: [id])
  manager            User?           @relation("UserManager", fields: [managerId], references: [id])
  subordinates       User[]          @relation("UserManager")
  role               Role?           @relation(fields: [roleId], references: [id])
}

model EmployeeArea {
  id     String @id @default(uuid())
  userId String
  areaId String
  user   User   @relation(fields: [userId], references: [id])

  @@unique([userId, areaId])
}

model Account {
  id            String    @id @default(uuid())
  accountCode   String    @unique
  personName    String
  dateOfBirth   DateTime?
  contactNumber String
  businessType  String?
  customerStage String?
  funnelStage   String?
  assignedToId  String?
  areaId        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  assignedTo    User?     @relation(fields: [assignedToId], references: [id])
}
